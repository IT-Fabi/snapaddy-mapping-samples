{
  "customFields": [],
  "integrations": {
    "dynamics": {
      "mappings": {
        "lead": {
          "Subject": "{{ topic }}",
          "FirstName": "{{ firstName }}",
          "LastName": "{{ lastName }}",
          "Salutation": "{{ gender == -1? ('') : (gender == 0? ('Herr') : ('Frau')) }}",
          "JobTitle": "{{ position }}",
          "CompanyName": "{{ organization }}",
          "WebSiteUrl": "{{ website }}",
          "EMailAddress1": "{{ email }}",
          "Telephone1": "{{ phone }}",
          "MobilePhone": "{{ mobile }}",
          "Fax": "{{ fax }}",
          "Address1_Line1": "{{ street }}",
          "Address1_City": "{{ city }}",
          "Address1_PostalCode": "{{ zip }}",
          "Address1_Country": "{{ country }}",
          "Address1_StateOrProvince": "{{ state }}"
        },
        "contact": {
          "FirstName": "{{ firstName }}",
          "LastName": "{{ lastName }}",
          "Salutation": "{{ gender == -1? ('') : (gender == 0? ('Herr') : ('Frau')) }}",
          "JobTitle": "{{ position }}",
          "MobilePhone": "{{ mobile }}",
          "Fax": "{{ fax }}",
          "Telephone1": "{{ phone }}",
          "WebSiteUrl": "{{ website }}",
          "EMailAddress1": "{{ email }}",
          "Address1_Line1": "{{ street }}",
          "Address1_City": "{{ city }}",
          "Address1_PostalCode": "{{ zip }}",
          "Address1_Country": "{{ country }}",
          "Address1_StateOrProvince": "{{ state }}",
          "GenderCode": {
            "Value": "{{ execute(genderMapping) }}"
          },
          "ParentCustomerId": {
            "Id": "{{ _account.AccountId }}",
            "LogicalName": "account"
          }
        },
        "account": {
          "Name": "{{ organization }}",
          "WebSiteURL": "{{ website }}",
          "Telephone1": "{{ phone }}",
          "Fax": "{{ fax }}",
          "Address1_Line1": "{{ street }}",
          "Address1_PostalCode": "{{ zip }}",
          "Address1_City": "{{ city }}",
          "Address1_Country": "{{ country }}",
          "Address1_StateOrProvince": "{{ state }}"
        }
      },
      "code": {
        "contact": {
          "post": [
            "if(!mappedObject.ParentCustomerId || !mappedObject.ParentCustomerId.Id) {",
            "  delete mappedObject.ParentCustomerId;",
            "}",
            "return mappedObject;"
          ]
        },
        "functions": {
          "genderMapping": [
            "  if (address.gender === 0) { return 1; }",
            "  if (address.gender === 1) { return 2; }",
            "  return null;                           "
          ]
        }
      }
    }
  }
}
